{% extends 'base.html.twig' %}

{% block title %}<title>Utilisateur - Video Retro</title>{% endblock %}

{% block body %}
    {% include '_header.html.twig' %}

    {# Fil d'Ariane #}
    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item ms-3"><a class="aBreadCrumb" href="{{path('home')}}">Accueil</a></li>
            <li class="breadcrumb-item"><a class="aBreadCrumb" href="{{path('app_admin_home')}}">Back office</a></li>
            <li class="breadcrumb-item"><a class="aBreadCrumb" href="{{path('app_user_index')}}">Liste des utilisateurs</a></li>
            <li class="breadcrumb-item active" aria-current="page">Profil de {{ user.prenom }} {{ user.nom|upper }}</li>
        </ol>
    </nav>


    <h1>Utilisateur</h1>
    
    <main class="container">{% block main %}


        <div class="table-responsive">
            <table class="table table-bordered mb-5">
                <tbody>
                    <tr>
                        <th class="myPrimary bg-light">Id</th>
                        <td class="bg-light">{{ user.id }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary">Email</th>
                        <td>{{ user.email }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary bg-light">Nom</th>
                        <td class="bg-light">{{ user.nom }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary">Prénom</th>
                        <td>{{ user.prenom }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary bg-light">Date de naissance</th>
                        <td class="bg-light">{{user.dateNaiss|date('d/m/Y')}}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary">Adresse</th>
                        <td>{{ user.adrUser }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary bg-light">Complément d'adresse</th>
                        <td class="bg-light">{{ user.complementAdr }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary">Code postal</th>
                        <td>{{ user.codePostal }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary bg-light">Ville</th>
                        <td class="bg-light">{{ user.ville }}</td>
                    </tr>
                    <tr>
                        <th class="myPrimary">Numéro de téléphone</th>
                        <td>{{ user.telUser }}</td>
                    </tr>

                    {#  On associe le rôle à un nom de rôle lisible #}
                    {% set roleNames = {  
                        'ROLE_ADMIN': 'Administrateur',
                        'ROLE_USER': 'Utilisateur',
                    } %}
                    <tr>
                        <th class="myPrimary bg-light">Rôle(s)</th>
                        <td class="bg-light">
                            {% set userRoleNames = [] %}
                            {% for role in user.roles %}
                                {# Attribution du nom correspondant au rôle dans roleNames, sinon le nom du rôle est utilisé #}
                                {% set roleName = roleNames[role] ?? role %}  
                                {# Vérification si le nom du rôle n'est pas déjà dans userRoleNames #}
                                {% if roleName not in userRoleNames %}
                                    {# Ajout du nom du rôle dans userRoleNames #}
                                    {% set userRoleNames = userRoleNames|merge([roleName]) %}
                                {% endif %}
                            {% endfor %}
                            {# Affichage des noms des rôles de l'utilisateur, séparés par une virgule et un saut de ligne, avec autorisation du rendu brut  #}
                            {{ userRoleNames|join(',<br>')|raw }}
                        </td>
                    </tr>
                    {# <tr>
                        <th>Password</th>
                        <td>{{ user.password }}</td>
                    </tr> #}
                </tbody>
            </table>
        </div>
        
        <div class="d-flex justify-content-between mb-5">
            <a class="btn bg-myPrimary text-white" href="{{ path('app_user_edit', {'id': user.id}) }}">Modifier</a>
            {{ include('user/_delete_form.html.twig') }}
        </div>

        <a class="btn bg-secondary text-white mb-5" href="{{ path('app_user_index') }}">Retour à la liste</a>

    {% endblock %}</main>
    {% include "_footer.html.twig" %}
{% endblock %}
